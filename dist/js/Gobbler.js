"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_MovementStrategy=require("./MovementStrategy"),_MovementStrategy2=_interopRequireDefault(_MovementStrategy),_plusOrMinus=require("./plusOrMinus"),_plusOrMinus2=_interopRequireDefault(_plusOrMinus),_environment=require("./environment"),_environment2=_interopRequireDefault(_environment),mutationCoefficientProperties=["v","attackCoefficient","defenceCoefficient","photosynthesisCoefficient"],evolutionPointProperties=["attackCoefficient","defenceCoefficient","photosynthesisCoefficient"],mutateProperty=R.curry(function(e,t){var i=e[t],n=i*(1+(Math.random()-.5)*e.mutationCoefficient);e[t]=0>i?1e-6:n}),calculateChildCoords=function(){var e=4*this.radius,t=this.x,i=this.y;if(e>=t)return{x:t+e,y:i};if(t>=_environment2["default"].sideLength-e)return{x:t-e,y:i};if(e>=i)return{x:t,y:i+e};if(i>=_environment2["default"].sideLength-e)return{x:t,y:i-e};var n=2*(Math.random()-.5)*e;return{x:t+n,y:i+_plusOrMinus2["default"](Math.pow(Math.pow(e,2)-Math.pow(n,2),.5))}},Gobbler=function(){function e(t){var i=t.energy,n=t.x,o=t.y,r=t.v,s=t.attackCoefficient,a=t.defenceCoefficient,u=t.photosynthesisCoefficient,f=t.generation,h=t.movementStrategy;_classCallCheck(this,e),this.attackCoefficient=s,this.defenceCoefficient=a,this.energy=i,this.generation=f,this.metabolism=.001,this.movementStrategy=new _MovementStrategy2["default"](this,h),this.mutationCoefficient=.3,this.photosynthesisCoefficient=u,this.threshold=12,this.v=r,this.x=n,this.y=o}return _createClass(e,[{key:"move",value:function(e){return this.movementStrategy.move(e)}},{key:"mutate",value:function(){var e=this;R.forEach(mutateProperty(this),mutationCoefficientProperties);var t=R.sum(R.props(evolutionPointProperties,this)),i=_environment2["default"].maxEvolutionPoints/t;return t>_environment2["default"].maxEvolutionPoints&&R.forEach(function(t){return e[t]*=i},evolutionPointProperties),this.movementStrategy=Math.random()<Math.pow(this.mutationCoefficient,2)?new _MovementStrategy2["default"](this):this.movementStrategy,this.v=this.v>_environment2["default"].maximumSpeed?_environment2["default"].maximumSpeed:this.v,this}},{key:"photosynthesize",value:function(e){var t=this.photosynthesisCoefficient*this.radius*e.light()*e.carbonDioxideLevel/e.initialGobblersCount/1e3;return this.energy+=t,e.increaseAtmosphereOxygenComposition(t),this}},{key:"reproduce",value:function(t,i){if(this.energy>this.threshold){var n=calculateChildCoords.call(this);t.reproductionCount++,this.generation++,i.push(new e({x:n.x,y:n.y,energy:this.energy/2,v:this.v,attackCoefficient:this.attackCoefficient,defenceCoefficient:this.defenceCoefficient,generation:this.generation,photosynthesisCoefficient:this.photosynthesisCoefficient,movementStrategy:this.movementStrategy}).mutate()),this.energy=this.energy/2,t.intYoungestGen<this.generation&&(t.intYoungestGen=this.generation)}return this}},{key:"respire",value:function(e){var t=this.energy*this.metabolism;return this.energy-=t,e.increaseAtmosphereOxygenComposition(-t),this}},{key:"radius",get:function(){return Math.sqrt(this.energy)}}]),e}();exports["default"]=Gobbler,module.exports=exports["default"];