"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}for(var _tinytic=require("tinytic"),_tinytic2=_interopRequireDefault(_tinytic),_AnalysisView=require("./AnalysisView"),_AnalysisView2=_interopRequireDefault(_AnalysisView),_canvasView=require("./canvasView"),_canvasView2=_interopRequireDefault(_canvasView),_Gobbler=require("./Gobbler"),_Gobbler2=_interopRequireDefault(_Gobbler),_environment=require("./environment"),_environment2=_interopRequireDefault(_environment),_stats=require("./stats"),_stats2=_interopRequireDefault(_stats),gobblers=[],analysisView=_AnalysisView2["default"](),calculateAttackStrength=function(e){var t=e.attackCoefficient,n=e.energy;return t*n},calculateDefenceStrength=function(e){var t=e.defenceCoefficient,n=e.energy;return t*n},attack=function(e,t,n){return calculateAttackStrength(e)>=calculateDefenceStrength(t)&&(n.eatCount++,e.energy+=t.energy,t.energy=0),e},removeDead=R.filter(function(e){return e.energy<.1?(_stats2["default"].deathCount++,_environment2["default"].increaseAtmosphereOxygenComposition(-e.energy),!1):!0}),checkPossibleContactX=function(e,t){var n=e.x,r=e.radius,a=t.x,i=t.radius;return n+r>=a-i&&a+i>=n-r},checkContact=function(e,t){var n=e.x,r=e.y,a=e.radius,i=t.x,o=t.y,s=t.radius;return Math.pow(Math.pow(n-i,2)+Math.pow(r-o,2),.5)<=a+s},i=0;i<_environment2["default"].initialGobblersCount;i++){var gobblerParams={x:0,y:0,energy:_environment2["default"].initialGobblerEnergy,v:1,attackCoefficient:.5,defenceCoefficient:.5,generation:0,photosynthesisCoefficient:1};gobblers[i]=new _Gobbler2["default"](gobblerParams);var radius=gobblers[i].radius;gobblers[i].x=Math.random()*(_environment2["default"].sideLength-2*radius)+radius,gobblers[i].y=Math.random()*(_environment2["default"].sideLength-2*radius)+radius,gobblers[i].mutate()}!function e(){window.requestAnimationFrame(e),_stats2["default"].resetValuesCalculatedEachIteration(),gobblers=R.sort(function(e,t){return e.x-t.x},gobblers);for(var t=0;t<gobblers.length;t++){for(var n=gobblers[t],r=t-1;r>=0&&checkPossibleContactX(n,gobblers[r]);){var a=gobblers[r];checkContact(n,a)&&attack(n,a,_stats2["default"]),r--}for(r=t+1;r<gobblers.length&&checkPossibleContactX(n,gobblers[r]);){var a=gobblers[r];checkContact(n,a)&&attack(n,a,_stats2["default"]),r++}n.photosynthesize(_environment2["default"]).move(_environment2["default"]).reproduce(_stats2["default"],gobblers).respire(_environment2["default"]),_stats2["default"].recordGobblerPropertiesForThisIteration(n)}gobblers=removeDead(gobblers),_stats2["default"].totalGobblers=gobblers.length,analysisView.render({environment:_environment2["default"],stats:_stats2["default"],secondsElapsed:(_tinytic2["default"].total()/1e3).toFixed(0)}),_canvasView2["default"].render({gobblers:gobblers,lightLevel:(255*_environment2["default"].light()).toFixed(0),totalAttackCoefficient:_stats2["default"].totalAttackCoefficient,totalDefenceCoefficient:_stats2["default"].totalDefenceCoefficient,totalPhotosynthesisCoefficient:_stats2["default"].totalPhotosynthesisCoefficient})}();